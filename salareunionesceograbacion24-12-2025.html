<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Capacitación VIP | Cuarzo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src='https://meet.jit.si/external_api.js'></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; height: 100vh; margin: 0; overflow: hidden; }
        #jitsi-container { width: 100%; height: 100%; background: #000; }
        
        #login-overlay {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; align-items: center; justify-content: center;
            padding: 20px;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 28px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .btn-join {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            transition: all 0.3s ease;
        }

        .btn-join:active { transform: scale(0.95); }

        /* Estilo para que el iframe ocupe todo y no muestre bordes raros en móvil */
        iframe { border: none !important; }
    </style>
</head>
<body>

    <!-- Pantalla de Bienvenida -->
    <div id="login-overlay">
        <div class="glass-panel">
            <div class="mb-8">
                <div class="w-16 h-16 bg-indigo-600 rounded-2xl mx-auto flex items-center justify-center mb-4 shadow-lg shadow-indigo-500/20">
                    <i class="fas fa-video text-2xl text-white"></i>
                </div>
                <h1 class="text-2xl font-bold tracking-tight">Acceso Capacitación</h1>
                <p class="text-gray-400 text-xs mt-2 uppercase tracking-widest font-semibold">Cuarzo Cristal VIP</p>
            </div>

            <div class="space-y-4">
                <input id="user-name" type="text" placeholder="Tu nombre" 
                       class="w-full px-5 py-4 rounded-xl bg-white/5 border border-white/10 text-white text-center focus:outline-none focus:border-indigo-500 transition-all" />
                
                <button id="btn-join" onclick="initCapacitacion()" class="btn-join w-full py-4 rounded-xl font-bold text-white shadow-xl">
                    ENTRAR A LA REUNIÓN
                </button>
                <div id="loader" class="hidden py-4">
                    <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-500 mx-auto"></div>
                    <p class="text-[10px] text-gray-500 mt-2">CONFIGURANDO CÁMARA...</p>
                </div>
            </div>
            
            <p class="mt-6 text-[10px] text-gray-500 leading-relaxed uppercase font-bold">
                Compatible con iPhone, Android y Windows<br>
                <span class="text-indigo-400">Activa tu micro y cámara al entrar</span>
            </p>
        </div>
    </div>

    <!-- Interfaz de Sala -->
    <div class="flex flex-col h-screen">
        <!-- Header -->
        <div class="h-14 bg-zinc-900/50 border-b border-white/5 flex items-center justify-between px-6 shrink-0">
            <div class="flex items-center gap-3">
                <span class="text-white font-black italic text-sm tracking-tighter">CUARZO <span class="text-indigo-500">CLOUD</span></span>
                <span id="recording-status" class="hidden text-[9px] bg-red-600 text-white px-2 py-0.5 rounded font-bold animate-pulse">REC</span>
            </div>
            <div id="user-display" class="text-[10px] text-gray-400 font-bold uppercase"></div>
        </div>
        
        <!-- Video -->
        <div class="flex-1 bg-black relative">
            <div id="jitsi-container"></div>
        </div>
    </div>

    <script>
        let api = null;

        async function initCapacitacion() {
            const name = document.getElementById('user-name').value.trim();
            if (!name) return;

            document.getElementById('btn-join').classList.add('hidden');
            document.getElementById('loader').classList.remove('hidden');

            try {
                // Solicitar permisos explícitamente (Crítico para iPhone/Android)
                await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                startMeeting(name);
            } catch (err) {
                console.warn("Permisos denegados, intentando entrar igual...", err);
                startMeeting(name);
            }
        }

        function startMeeting(name) {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('user-display').innerText = name;

            const domain = 'meet.jit.si';
            // Sala fija para la prueba de hoy
            const roomID = 'Cuarzo_Capacitacion_Premium_Test';

            const options = {
                roomName: roomID,
                width: '100%',
                height: '100%',
                parentNode: document.querySelector('#jitsi-container'),
                userInfo: { displayName: name },
                configOverwrite: {
                    startWithAudioMuted: false,
                    startWithVideoMuted: false,
                    prejoinPageEnabled: false,
                    disableDeepLinking: false, // Permite abrir la App en iPhone si la tienen
                    resolution: 720,
                    // Grabación y Pantalla Compartida
                    localRecording: {
                        enabled: true,
                        format: 'flac'
                    }
                },
                interfaceConfigOverwrite: {
                    TOOLBAR_BUTTONS: [
                        'microphone', 'camera', 'desktop', 'chat', 'raisehand', 
                        'recording', 'tileview', 'fullscreen', 'hangup', 'shareaudio', 'videobackgroundblur'
                    ],
                    SETTINGS_SECTIONS: [ 'devices', 'language', 'profile', 'calendar' ],
                    SHOW_CHROME_EXTENSION_BANNER: false
                }
            };

            api = new JitsiMeetExternalAPI(domain, options);

            // Manejo de eventos
            api.addEventListener('videoConferenceJoined', () => {
                api.executeCommand('toggleTileView');
            });

            // Detectar si alguien inicia grabación (informativo)
            api.addEventListener('recordingStatusChanged', (event) => {
                const recLabel = document.getElementById('recording-status');
                if(event.on) recLabel.classList.remove('hidden');
                else recLabel.classList.add('hidden');
            });
        }

        // Enter Key Support
        document.getElementById('user-name').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initCapacitacion();
        });
    </script>
</body>
</html>